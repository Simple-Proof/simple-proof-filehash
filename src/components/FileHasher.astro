---
import Footer from '../components/Footer.astro';
---

<div class="min-h-screen bg-background py-8 px-4 sm:px-6 lg:px-8 flex flex-col">
  <div class="max-w-4xl mx-auto flex-grow w-full">
    <div class="logo-container flex justify-center mb-5 pt-[60px] md:pt-[30px] md:mb-8">
      <a href="https://simpleproof.com">
      <img src="/logo.svg" alt="Simple Proof Logo" class="h-[30px] md:h-[80px] w-auto">
      </a>
    </div>
    <div class="text-center mt-8">
      <h1 class="text-3xl font-ibm-bold text-primary sm:text-4xl">
        Hash List Generator
      </h1>
      <p class="mt-3 text-lg text-text-secondary">
        Calculate SHA-256 hashes of your files directly in the browser
      </p>
    </div>

    <div class="mt-8">
      <!-- Upload card -->
      <div class="bg-white rounded-lg shadow-light p-6 mb-6">
        <div class="flex flex-col md:flex-row md:items-center">
          <!-- Left side with icon and text -->
          <div class="md:w-1/3 mb-4 md:mb-0">
            <div class="flex items-center mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-tertiary mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <h2 class="text-primary font-ibm-semibold text-xl">Upload Files</h2>
            </div>
            <p class="text-text-light text-sm">
              Add files to generate SHA-256 hashes.<br>
              <span class="text-xs text-text-lighter">Maximum 1000 files.</span><br>
              All processing happens locally in your browser for maximum security.
            </p>
          </div>

          <!-- Right side with drop zone -->
          <div class="md:w-2/3 md:pl-4">
            <div 
  id="dropZone"
  class="border-2 border-dashed border-border-medium rounded-lg p-6 cursor-pointer text-center hover:border-primary transition-all duration-200 ease-in-out [&>*]:pointer-events-none [&>label]:pointer-events-auto [&>label>input]:pointer-events-auto"
>
              <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-8 w-8 text-primary mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
              </svg>
              <p class="text-text-secondary mb-2">Drag and drop your files here</p>
              <p class="text-text-lighter text-sm mb-3">OR</p>
              <label
                for="file-upload"
                class="browse-button bg-primary hover:bg-primary-shade text-white py-2 px-4 rounded text-sm transition-colors font-ibm-medium inline-block cursor-pointer"
              >
                Browse Files
                <input
                  id="file-upload"
                  type="file"
                  multiple
                  class="sr-only"
                />
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Card (initially hidden) -->
      <div id="progressCard" class="bg-white rounded-lg shadow-light p-6 mb-6 hidden">
        <div class="flex items-center mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary mr-2 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          <h2 class="text-primary font-ibm-semibold text-xl">Processing Files</h2>
        </div>
        
        <div class="space-y-4">
          <div>
            <div class="flex justify-between text-sm text-text-secondary mb-1">
              <span id="progressText">Processing files...</span>
              <span id="progressNumbers">0 / 0</span>
            </div>
            <div class="w-full bg-background-light rounded-full h-2">
              <div id="progressBar" class="bg-primary h-2 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
            </div>
          </div>
          
          <div id="currentFileInfo" class="text-sm text-text-light">
            <span id="currentFileName">Preparing...</span>
          </div>
          
          <div class="text-xs text-text-lighter">
            <div class="flex justify-between">
              <span>Files processed: <span id="processedCount" class="font-mono">0</span></span>
              <span>Files remaining: <span id="remainingCount" class="font-mono">0</span></span>
            </div>
          </div>
        </div>
      </div>

      <!-- Debug info (hidden by default) -->
      <div id="debugInfo" class="mt-4 p-3 bg-background-light dark:bg-gray-800 rounded-md text-sm hidden">
        <p class="font-ibm-medium mb-1">Drag & Drop Debug Info:</p>
        <div id="debugText" class="font-mono text-xs"></div>
      </div>

      <!-- Results Card -->
      <div class="bg-white rounded-lg shadow-light overflow-hidden">

        <div class="p-4 flex items-center justify-between border-b border-border-light">
          <div class="flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h2 class="text-text font-ibm-medium text-lg">File Hashes</h2>
          </div>
          <div class="flex items-center space-x-4">
            <div id="fileCounter" class="text-sm text-text-secondary hidden">
              <span id="fileCount">0</span> files processed
            </div>
            <!-- Items per page selector -->
            <div id="itemsPerPageSelector" class="hidden">
              <label for="itemsPerPage" class="text-sm text-text-secondary mr-2">Show:</label>
              <select id="itemsPerPage" class="text-sm border border-border-medium rounded px-2 py-1 pr-8 focus:border-primary focus:ring-1 focus:ring-primary appearance-none bg-white">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="all">All</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Table Headers -->
        <div class="hidden" id="resultsTable">
          <div class="grid grid-cols-12 bg-background-light text-sm font-ibm-medium text-text-dark p-3">
            <div class="col-span-11 md:col-span-10 grid grid-cols-1 md:grid-cols-12 gap-1 md:gap-0">
              <div class="md:col-span-6">SHA-256 Hash</div>
              <div class="md:col-span-5">File Name</div>
              <div class="hidden md:block md:col-span-1">Extension</div>
            </div>
            <div class="col-span-1 text-center hidden md:block">Actions</div>
          </div>

          <!-- Table Body -->
          <div class="divide-y divide-border-light" id="resultsBody">
            <!-- Results will be inserted here dynamically -->
          </div>
        </div>

        <!-- Empty state -->
        <div id="emptyState" class="py-12 text-center text-text-light">
          No files processed yet. Add files to see their hashes.
        </div>

        <!-- Pagination -->
        <div id="paginationContainer" class="hidden border-t border-border-light bg-background-light px-4 py-3">
          <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0">
            <div class="flex items-center text-sm text-text-secondary order-2 md:order-1">
              <span id="paginationInfo">Showing 0 to 0 of 0 results</span>
            </div>
            <div class="flex items-center space-x-2 order-1 md:order-2">
              <button 
                id="prevButton" 
                class="flex items-center px-1 md:px-3 py-2 md:py-1 text-sm border border-border-medium rounded-lg md:rounded hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-w-[70px] md:min-w-0 justify-center"
                disabled
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <span class="md:inline hidden">Previous</span>
              </button>
              
              <div id="pageNumbers" class="flex items-center space-x-1">
                <!-- Page numbers will be inserted here -->
              </div>
              
              <button 
                id="nextButton" 
                class="flex items-center px-1 md:px-3 py-2 md:py-1 text-sm border border-border-medium rounded-lg md:rounded hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-w-[70px] md:min-w-0 justify-center"
              >
                <span class="md:inline hidden">Next</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-6 flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4 hidden" id="actionButtons">
        <div class="flex flex-grow max-w-xs">
          <div class="relative flex-grow">
            <label for="filenameInput" class="block text-sm font-ibm-medium text-text-dark dark:text-gray-300 mb-1">Filename</label>
            <input 
              type="text" 
              id="filenameInput" 
              class="block w-full rounded-md border-border-medium dark:border-gray-700 shadow-sm focus:border-primary focus:ring-primary text-sm bg-white dark:bg-gray-800 text-text-dark dark:text-gray-100 px-3 py-2" 
            />
          </div>
        </div>
        <div class="flex justify-end space-x-4">
          <button
            type="button"
            id="clearAllButton"
            class="inline-flex items-center px-4 py-2 border border-border-medium dark:border-gray-700 shadow-sm text-sm font-ibm-medium rounded-md text-text-dark dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-background-light dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
          >
            Clear All
          </button>
          <button
            type="button"
            id="copyButton"
            class="inline-flex items-center px-4 py-2 border border-border-medium dark:border-gray-700 shadow-sm text-sm font-ibm-medium rounded-md text-text-dark dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-background-light dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
          >
            Copy to Clipboard
          </button>
          <button
            type="button"
            id="downloadButton"
            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-ibm-medium rounded-md text-white bg-tertiary hover:bg-tertiary-shade focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-tertiary"
          >
            Download CSV
          </button>
        </div>
      </div>
    </div>
  </div>

  <Footer />

</div>

<script>
import { FileHasherApp } from '../lib/FileHasherApp.js';

let app: FileHasherApp;

document.addEventListener('DOMContentLoaded', async () => {
  try {
    app = new FileHasherApp();
    await app.initialize();
  } catch (error) {
    console.error('Failed to initialize File Hasher application:', error);
  }
});

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
  if (app) {
    app.destroy();
  }
});
</script>
